<!doctype html><html prefix="og: https://ogp.me/ns#" lang=en data-theme=light><head><meta charset=utf-8><title itemprop=name>Loop much? :: The Upside-Down Trees</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Amiri&family=Montserrat&display=swap" rel=stylesheet><meta property="og:title" content="Loop much? | The Upside-Down Trees"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Loop much? | The Upside-Down Trees"><meta itemprop=name content="Loop much? | The Upside-Down Trees"><meta name=application-name content="Loop much? | The Upside-Down Trees"><meta property="og:site_name" content="blog.mhashim6.me"><meta name=description content="Combining list/ array operators in a single iteration"><meta itemprop=description content="Combining list/ array operators in a single iteration"><meta property="og:description" content="Combining list/ array operators in a single iteration"><meta name=twitter:description content="Combining list/ array operators in a single iteration"><base href=https://blog.mhashim6.me/loop-much/><link rel=canonical href=https://blog.mhashim6.me/loop-much/ itemprop=url><meta name=url content="https://blog.mhashim6.me/loop-much/"><meta name=twitter:url content="https://blog.mhashim6.me/loop-much/"><meta property="og:url" content="https://blog.mhashim6.me/loop-much/"><meta property="og:locale" content="en"><meta name=language content="English"><meta itemprop=image content="https://blog.mhashim6.me/images/loop-much.png"><meta property="og:image" content="https://blog.mhashim6.me/images/loop-much.png"><meta property="og:updated_time" content="252525-55-120T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://blog.mhashim6.mesitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content="@UpsideDownTrees"><link rel=apple-touch-icon sizes=180x180 href=https://blog.mhashim6.me/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mhashim6.me/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.mhashim6.me/favicon-16x16.png><link rel="shortcut icon" href=https://blog.mhashim6.me/favicon.ico><link rel=icon type=image/x-icon sizes="16x16 32x32" href=https://blog.mhashim6.me/favicon.ico><link rel=manifest href=https://blog.mhashim6.me/site.webmanifest><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#EDE3D9"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#17191C"><link rel=author href=https://blog.mhashim6.me/humans.txt><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"UpsideDownTrees","url":"https://blog.mhashim6.me","sameAs":["https://mhashim6.me","https://linkedin.com/in/mhashim6","https://github.com/mhashim6"]}</script><script>const storage=localStorage.getItem("dark-mode");("dark"===storage||!storage&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.documentElement.setAttribute("data-theme","dark")</script><script src=https://blog.mhashim6.me/js/darkm.min.1be248604351b865213d07e5a761998a21e20d82ba86c4fe72cddc853f108b7d.js></script>
<link rel=stylesheet href=https://blog.mhashim6.me/css/style.min.35968471b7890ab7126db15dfbd7570a8412c6c4c3c736004dbe08d9bbcd02f0.css><link rel=stylesheet href=css/synatx.css><script defer data-domain=blog.mhashim6.me src=https://plausible.io/js/script.js></script></head><body class=single><header class=site-header><link rel=alternate type=application/rss+xml href=https://blog.mhashim6.me/index.xml title="The Upside-Down Trees"><div class=inner><p class="site-title slide-horizontal-invert"><a href=https://blog.mhashim6.me/>UpsideDownTrees</a></p><input type=checkbox id=check-menu class=check-menu hidden>
<label for=check-menu class="nav-btn hide-desktop" aria-label="Open/close menu"><span class=lines></span></label><nav class="site-nav hide-mobile slide-horizontal"><button class="theme__btn light--hidden" aria-label="Enable light mode"><svg aria-hidden="true" viewBox="0 0 24 24" id="sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button>
<button class="theme__btn dark--hidden" aria-label="Enable dark mode"><svg aria-hidden="true" viewBox="0 0 24 24" id="moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button><ul class=site-menu><li><a target=_blank href=https://t.me/UpsideDownTrees><span>Telegram</span></a></li><li><a target=_blank href=https://mhashim6.me><span>About me?</span></a></li><li><a href=https://blog.mhashim6.me/index.xml><span>RSS</span></a></li><li><a href=https://blog.mhashim6.me/posts/><span>Archive</span></a></li></ul></nav></div></header><main class=site-main><article><header class=subheader style=background-image:url(/images/loop-much.png)><div class="title-container slide-invert"><h1 class=post-title>Loop much?</h1><figcaption><i></i></figcaption><div><div class=taxonomy><a class="chip no-decor" href=https://blog.mhashim6.me/tags/fp>FP</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/function-currying>Function Currying</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/closure>Closure</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/javascript>javascript</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/typescript>typescript</a></div></div></div></header><div class="content slide-invert"><div dir=ltr><p>So you have multiple operations that you want to perform on a list, you&rsquo;re a good lad <em>(or lass)</em> and you&rsquo;re not using a giant <code>for</code> loop; you&rsquo;re feeling clever today and you&rsquo;ll be using functional operators like <code>map</code>, <code>filter</code>, and <code>reduce</code>.</p><p>But the list is relatively big, and even though it looks elegant, iterating on it 10 times is not exactly up for a performance award.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>...,</span> <span class=mi>100000</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>it</span> <span class=p>=&gt;</span> <span class=nx>it</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>it</span> <span class=p>=&gt;</span> <span class=nx>it</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>moreOps</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>filter</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>moreOps</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>filter</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>it</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>it</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=no-im-not-here-to-talk-about-the-order-of-operators>No, I&rsquo;m not here to talk about the order of operators</h2><p>It&rsquo;s important, but it&rsquo;s not always applicable. Instead, I want to discuss <code>transducers</code>, not the energy transformation devices, but the concept itself.</p><p>You want to have your cake and eat it too—use the operators but with a single iteration. It&rsquo;s quite an old problem, and so is its solution. Today we&rsquo;ll focus on just <code>filter</code>.</p><h2 id=closures-not-the-ones-you-know>Closures, not the ones you know</h2><details><summary>Let's take a look at <code>filter</code></summary><p>It takes a predicate function that receives an item and <code>returns</code> a <code>boolean</code> value. Based on this returned value the item is either kept or discarded.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>evenOnly</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>].</span><span class=nx>filter</span><span class=p>(</span><span class=nx>it</span> <span class=p>=&gt;</span> <span class=nx>it</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=c1>// [2, 4, 6]
</span></span></span></code></pre></div></details><p>We can create an object that keeps track of each predicate used on an array, and this is actually a perfect solution for implementing the same concept in other operators.</p><p>Without changing <code>filter</code> implementation or introducing a new <code>filter</code> function, <strong>we can use a simpler approach</strong> for the sake of this post, and it&rsquo;s a very powerful concept in many other applications as well: <code>Closures</code>.</p><p>You might know that a <code>closure</code> is basically capturing the enclosing environment in the body of an inner environment/ function. <strong>But this is not the <code>closure</code> we are talking about</strong> here; Being able to manipulate/combine functions to produce another function with the same characteristics is also called a <code>closure</code> ¯\<em>(ツ)</em>/¯</p><blockquote><p>An operation for combining data objects satisfies the closure property if the results of combining things with that operation can themselves be combined using the same operation.</p><p>—<strong>Structure & Interpretation of Computer Programs</strong></p></blockquote><h2 id=allow-me-to-elaborate-whats-a-predicate>Allow me to elaborate, what&rsquo;s a predicate?</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>type</span> <span class=nx>Predicate</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;</span> <span class=o>=</span> <span class=p>(</span><span class=nx>item</span>: <span class=kt>T</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=kr>boolean</span><span class=p>;</span>
</span></span></code></pre></div><p>A simple <code>boolean</code> value of <code>true</code> can be transformed to another <code>boolean</code> value of <code>false</code> by different types of manipulation. Can we do the same to a function like a predicate?</p><p>let us look at different ways to manipulate a <code>boolean</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kc>false</span> <span class=o>&amp;&amp;</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kc>false</span> <span class=o>||</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kc>false</span> <span class=o>&amp;&amp;</span> <span class=kc>true</span><span class=p>;</span> <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kc>false</span> <span class=o>||</span> <span class=kc>true</span><span class=p>;</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>!</span><span class=kc>false</span> <span class=c1>// true
</span></span></span></code></pre></div><p>And much more. Can we apply <code>and</code>, <code>or</code>, <code>not</code> to our predicates? Why of course we can! Why do you think I&rsquo;m writing this? We just need to make the right representation of the effect of these operators:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>and</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>predicate1</span>: <span class=kt>Predicate</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>predicate2</span>: <span class=kt>Predicate</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>item</span>: <span class=kt>T</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>predicate1</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>predicate2</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>or</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>predicate1</span>: <span class=kt>Predicate</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>predicate2</span>: <span class=kt>Predicate</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>item</span>: <span class=kt>T</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>predicate1</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=o>||</span> <span class=nx>predicate2</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>not</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>predicate</span>: <span class=kt>Predicate</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>item</span>: <span class=kt>T</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>!</span><span class=nx>predicate</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span></code></pre></div><p>It&rsquo;s utilising the same primitive <code>boolean</code> operations, and at the same time <strong>combines</strong> the predicates. Well, it combines their results. Which is what we care about.</p><p>Most importantly, calls to <code>and</code>, <code>or</code>, <code>not</code> also return a predicate! This allows to endlessly combine results of our combinations! This is the power of <em>(the other)</em> closures!</p><p>Why are we returning a function that accepts the other predicate instead of taking it as another parameter? <a href=https://blog.mhashim6.me/fp-and-oop-are-close-siblings/>Glad you asked</a>!</p><h2 id=why-did-we-do-this-again>Why did we do this again?</h2><p>Because now that you can combine predicates together, you can have the same elegance of separating your filters while making a single call to <code>filter</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>even</span> <span class=o>=</span> <span class=p>(</span><span class=nx>n</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>n</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span><span class=mi>0</span><span class=p>;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>productOfThree</span> <span class=o>=</span> <span class=p>(</span><span class=nx>n</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>n</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>evenAndProductOfThree</span> <span class=o>=</span> <span class=nx>and</span><span class=p>(</span><span class=nx>even</span><span class=p>)(</span><span class=nx>productOfThree</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>evenAndProductOfThree</span><span class=p>);</span> <span class=c1>// [6, 12]
</span></span></span></code></pre></div><p>Or on the fly, since <code>evenAndProductOfThree</code> is also a predicate, we can reuse it</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>not</span><span class=p>(</span><span class=nx>evenAndProductOfThree</span><span class=p>));</span> <span class=c1>// [3, 9]
</span></span></span></code></pre></div><p>You can combine and accumulate as much predicates as you want, it&rsquo;ll all be run in a single iteration. But it also allows you to maintain the elegance of separating your predicates and combining them as building blocks to build the most suitable filter you need for your data.</p><h2 id=what-did-you-mention-transducers-for>What did you mention transducers for?</h2><p>Well, it&rsquo;s true this is not exactly a transducer, rather an introduction to the other meaning of <code>closures</code> so that in the next post, transducers will be our focus in sha&rsquo; Allah.</p></div><button onclick='(()=>{navigator.share({url:"https://blog.mhashim6.me/loop-much/"})})()'>
Share This Post <img src=https://img.icons8.com/ios-glyphs/22/17191C/share-rounded.png></button><div class=taxonomy><a class="chip category" href=https://blog.mhashim6.me/categories/tech>Tech</a>
<a class="chip category" href=https://blog.mhashim6.me/categories/guide>Guide</a></div><script id=telegram_comments async src=https://comments.app/js/widget.js?3 data-comments-app-website=b14MWwEx data-limit=1000 data-page-id=https://blog.mhashim6.me/loop-much/ data-color=ceaa37 data-colorful=1 dark=0></script></div></article></main><footer class=site-footer><p class=copyright>© 2025 The Upside-Down Trees</p><ul class=social-links><li><a target=_blank class='icon icon-website' href=https://mhashim6.me aria-label="Follow on Website"></a></li><li><a target=_blank class='icon icon-linkedin' href=https://www.linkedin.com/in/mhashim6/ aria-label="Follow on LinkedIn"></a></li><li><a target=_blank class='icon icon-github' href=https://github.com/mhashim6 aria-label="Follow on GitHub"></a></li><li><a target=_blank class='icon icon-telegram' href=https://t.me/mhashim6 aria-label="Follow on Telegram"></a></li><li><a target=_blank class='icon icon-email' href=mailto:msg@mhashim6.me aria-label="Follow on Email"></a></li></ul></footer><script src=https://blog.mhashim6.me/js/prefixfree.min.9cea59c2cb403a83a6549aadada301521cf8b59b1abc0498e0a10432d186bd67.js></script></body></html>