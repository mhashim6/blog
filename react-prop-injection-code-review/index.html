<!doctype html><html prefix="og: https://ogp.me/ns#" lang=en data-theme=light><head><meta charset=utf-8><title itemprop=name>React Props Injection - Self-Review #2 :: The Upside-Down Trees</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Amiri&family=Montserrat&display=swap" rel=stylesheet><meta property="og:title" content="React Props Injection - Self-Review #2 | The Upside-Down Trees"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="React Props Injection - Self-Review #2 | The Upside-Down Trees"><meta itemprop=name content="React Props Injection - Self-Review #2 | The Upside-Down Trees"><meta name=application-name content="React Props Injection - Self-Review #2 | The Upside-Down Trees"><meta property="og:site_name" content="blog.mhashim6.me"><meta name=description content="React Components Dynamic Props Injection"><meta itemprop=description content="React Components Dynamic Props Injection"><meta property="og:description" content="React Components Dynamic Props Injection"><meta name=twitter:description content="React Components Dynamic Props Injection"><base href=https://blog.mhashim6.me/react-prop-injection-code-review/><link rel=canonical href=https://blog.mhashim6.me/react-prop-injection-code-review/ itemprop=url><meta name=url content="https://blog.mhashim6.me/react-prop-injection-code-review/"><meta name=twitter:url content="https://blog.mhashim6.me/react-prop-injection-code-review/"><meta property="og:url" content="https://blog.mhashim6.me/react-prop-injection-code-review/"><meta property="og:locale" content="en"><meta name=language content="English"><meta itemprop=image content="https://blog.mhashim6.me/images/self-review/self-review-2.png"><meta property="og:image" content="https://blog.mhashim6.me/images/self-review/self-review-2.png"><meta property="og:updated_time" content="6066-11-120T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://blog.mhashim6.mesitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content="@UpsideDownTrees"><link rel=apple-touch-icon sizes=180x180 href=https://blog.mhashim6.me/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mhashim6.me/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.mhashim6.me/favicon-16x16.png><link rel="shortcut icon" href=https://blog.mhashim6.me/favicon.ico><link rel=icon type=image/x-icon sizes="16x16 32x32" href=https://blog.mhashim6.me/favicon.ico><link rel=manifest href=https://blog.mhashim6.me/site.webmanifest><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#EDE3D9"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#17191C"><link rel=author href=https://blog.mhashim6.me/humans.txt><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"UpsideDownTrees","url":"https://blog.mhashim6.me","sameAs":["https://mhashim6.me","https://linkedin.com/in/mhashim6","https://github.com/mhashim6"]}</script><script>const storage=localStorage.getItem("dark-mode");("dark"===storage||!storage&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.documentElement.setAttribute("data-theme","dark")</script><script src=https://blog.mhashim6.me/js/darkm.min.1be248604351b865213d07e5a761998a21e20d82ba86c4fe72cddc853f108b7d.js></script>
<link rel=stylesheet href=https://blog.mhashim6.me/css/style.min.f3516da42c08ec512577cd9c0cfec521a4f185eaa6025cabc46f74ced7c98177.css><link rel=stylesheet href=css/synatx.css><script defer data-domain=blog.mhashim.me src=https://plausible.io/js/script.js></script></head><body class=single><header class=site-header><link rel=alternate type=application/rss+xml href=https://blog.mhashim6.me/index.xml title="The Upside-Down Trees"><div class=inner><p class="site-title slide-horizontal-invert"><a href=https://blog.mhashim6.me/>UpsideDownTrees</a></p><input type=checkbox id=check-menu class=check-menu hidden>
<label for=check-menu class="nav-btn hide-desktop" aria-label="Open/close menu"><span class=lines></span></label><nav class="site-nav hide-mobile slide-horizontal"><button class="theme__btn light--hidden" aria-label="Enable light mode"><svg aria-hidden="true" viewBox="0 0 24 24" id="sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button>
<button class="theme__btn dark--hidden" aria-label="Enable dark mode"><svg aria-hidden="true" viewBox="0 0 24 24" id="moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button><ul class=site-menu><li><a target=_blank href=https://t.me/UpsideDownTrees><span>Telegram</span></a></li><li><a target=_blank href=https://mhashim6.me><span>About me?</span></a></li><li><a href=https://blog.mhashim6.me/index.xml><span>RSS</span></a></li><li><a href=https://blog.mhashim6.me/posts/><span>Archive</span></a></li></ul></nav></div></header><main class=site-main><article><header class=subheader style=background-image:url(/images/self-review/self-review-2.png)><div class="title-container slide-invert"><h1 class=post-title>React Props Injection - Self-Review #2</h1><figcaption><i></i></figcaption><div><div class=taxonomy><a class="chip no-decor" href=https://blog.mhashim6.me/tags/react>React</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/react-native>React Native</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/react-props>React Props</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/cloneelement>cloneElement</a>
<a class="chip no-decor" href=https://blog.mhashim6.me/tags/code-review>Code-Review</a></div></div></div></header><div class="content slide-invert"><blockquote><p>This is the second post in an <a href=https://blog.mhashim6.me/categories/self-review-series/>ongoing series</a> of Self-Code-Review. Where I pick <em>subjectively</em> unique and interesting modules, in different projects, architectures, and languages.</p></blockquote><blockquote><p>It‚Äôs not always the code that matters, it‚Äôs the critiques and observations that we will learn most from.</p></blockquote><details><summary>Note for ReactNative devs</summary><p>I know you guys have a nice imagination otherwise you'd not have picked <code>jsx</code> to stare at most of your life. So I need you just to imagine that every <code>&lt;div></code> is just a <code>&lt;View></code> and go along with this. Nothing here is specific to <code>reactjs</code>. It's just React.</p></details><h2 id=the-props-distribution-issue>The Props distribution issue</h2><p>You&rsquo;re a good React dev, you want to reuse as much of your components while still maintaining a standardised layouts and characteristics.</p><p>So you have multiple Pages/Screens in your app. They&rsquo;re mostly similar in layout but can still be a bit different to suit its needs. And that&rsquo;s the mark of the good designer on your team.</p><p>There&rsquo;re many ways to make individual screens maintain the overall app style while being unique. For instance, there could be some common components like a header or a footer; some common styling like a colour accent per screen that matches the overall colour platte of the app.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Screen</span> <span class=o>=</span> <span class=p>({</span><span class=nx>themeColor</span><span class=p>,</span> <span class=nx>children</span><span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Header</span> <span class=na>themeColor</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{...</span><span class=nx>children</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Footer</span> <span class=na>themeColor</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>But this screen should be composed of multiple types of components that have their own responsibilities. Not only that, these components are reused in other screens/ parts of the app.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Landing</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>Screen</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;#EDE3D9&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>DummyChild</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;#EDE3D9&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>AnotherDummyChild</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;#EDE3D9&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>Screen</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Login</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>Screen</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;black&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>DummyChild</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;black&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>AnotherDummyChild</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;black&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>Screen</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h3 id=you-see-the-problem-here>You see the problem here?</h3><p>How do I maintain the style characteristics of every screen and its children without coupling each screen to its children? In a realistic app you can have a lot more screens and even more children <em>(good for ya!)</em> and not all screens share the same children. It&rsquo;s a mess.</p><h2 id=enter-prop-injection>Enter Prop Injection</h2><p>We need to dynamically pass props to children without having to writing them manually every time. We also don&rsquo;t want any children to assume which screen they&rsquo;re in; Children should be reusable in different screens. So our aim is close to this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Screen</span> <span class=o>=</span> <span class=p>({</span><span class=nx>themeColor</span><span class=p>,</span> <span class=nx>children</span><span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Header</span> <span class=na>themeColor</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{...</span><span class=nx>children</span> <span class=nx>themeColor</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Footer</span> <span class=na>themeColor</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Landing</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>Screen</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;#EDE3D9&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>DummyChild</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>AnotherDummyChild</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>Screen</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>This code unfortunately doesn&rsquo;t work (in this current form). But it already looks way cleaner and somewhat magical.</p><p>We can make it work though! Let&rsquo;s make a function that injects props to passed children</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>inject</span> <span class=o>=</span> <span class=p>(</span><span class=nx>props</span> <span class=o>=</span> <span class=p>{},</span> <span class=nx>children</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>React</span><span class=p>.</span><span class=nx>Children</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>children</span><span class=p>,</span> <span class=p>(</span><span class=nx>child</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>React</span><span class=p>.</span><span class=nx>isValidElement</span><span class=p>(</span><span class=nx>child</span><span class=p>)</span> <span class=o>?</span> <span class=nx>React</span><span class=p>.</span><span class=nx>cloneElement</span><span class=p>(</span><span class=nx>child</span><span class=p>,</span> <span class=nx>props</span><span class=p>)</span> <span class=o>:</span> <span class=nx>child</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span></code></pre></div><p>Let&rsquo;s get <code>React.isValidElement(child)</code> out of the way, it&rsquo;s just for handling stuff like raw strings and it&rsquo;s there for sanity.</p><p>What <code>inject</code> does is quite simple: It takes some children <em>(the post will get me into much trouble)</em> and dynamically injects the provided prop in each one of them before rendering them. And this is done by cloning the child <em>(Goodness ü§¶üèª‚Äç‚ôÇÔ∏è)</em> and injecting the new props.</p><p>I know you&rsquo;re probably thinking now <em>&ldquo;Oh but this must be quite inefficient!&rdquo;</em>. You&rsquo;re right to think so, but it&rsquo;s actually not correct. I&rsquo;ll tap on that later below, but first let&rsquo;s see how will this improve our code</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Screen</span> <span class=o>=</span> <span class=p>({</span><span class=nx>themeColor</span><span class=p>,</span> <span class=nx>children</span><span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Header</span> <span class=na>themeColor</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nx>inject</span><span class=p>({</span><span class=nx>themeColor</span><span class=p>},</span> <span class=nx>children</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Footer</span> <span class=na>themeColor</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>As you can see, this is the working code for the pseudo <code>{...children themeColor}</code>. Now we can simply pass any child to a <code>Screen</code> and it&rsquo;ll dynamically inherit the property</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Landing</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>Screen</span> <span class=na>themeColor</span><span class=o>=</span><span class=s>&#34;#EDE3D9&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>DummyChild</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>AnotherDummyChild</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>Screen</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>Yep nothing changed. Pure magic.</p><h2 id=the-case-for-reactcloneelement>The Case for <code>React.cloneElement</code></h2><p>Well at first I was going through this path in an experimental mindset. When I found that&rsquo;s actually a good-enough solution, I started to seriously consider its viability.</p><p>Is <code>React.cloneElement</code> a resource hog? Well, to my surprise it isn&rsquo;t. I was digging for resources about it and I found out this whole experiment already has a term now in the react community and people had this <a href=https://stackoverflow.com/questions/54922160/react-cloneelement-in-list-performance>performance discussion</a> already. In fact, some nice guy made a <a href=https://gist.github.com/nemoDreamer/21412b28dc65d51e2c5c8561a8f82ce1>benchmark</a> for it. So yeah it&rsquo;s good.</p><hr><h2 id=afterthoughts>Afterthoughts</h2><p>You now reached the state I was in when I first worked on that project. But you know much better of its pitfalls and why it is the way it is. Let&rsquo;s talk improvements in the comments!</p><p><strong>Ps</strong>: Full code can be found on <a href=https://github.com/mhashim6/self-review/tree/main/react-prop-injection>GitHub</a></p><button onclick='(()=>{navigator.share({url:"https://blog.mhashim6.me/react-prop-injection-code-review/"})})()'>
Share This Post <img src=https://img.icons8.com/ios-glyphs/22/17191C/share-rounded.png></button><div class=taxonomy><a class="chip category" href=https://blog.mhashim6.me/categories/self-review-series>Self-Review-Series</a>
<a class="chip category" href=https://blog.mhashim6.me/categories/tech>Tech</a>
<a class="chip category" href=https://blog.mhashim6.me/categories/guide>Guide</a></div><script id=telegram_comments async src=https://comments.app/js/widget.js?3 data-comments-app-website=b14MWwEx data-limit=1000 data-page-id=https://blog.mhashim6.me/react-prop-injection-code-review/ data-color=ceaa37 data-colorful=1 dark=0></script></div></article></main><footer class=site-footer><p class=copyright>¬© 2023 The Upside-Down Trees</p><ul class=social-links><li><a target=_blank class='icon icon-website' href=https://mhashim6.me aria-label="Follow on Website"></a></li><li><a target=_blank class='icon icon-linkedin' href=https://www.linkedin.com/in/mhashim6/ aria-label="Follow on LinkedIn"></a></li><li><a target=_blank class='icon icon-github' href=https://github.com/mhashim6 aria-label="Follow on GitHub"></a></li><li><a target=_blank class='icon icon-telegram' href=https://t.me/mhashim6 aria-label="Follow on Telegram"></a></li><li><a target=_blank class='icon icon-email' href=mailto:msg@mhashim6.me aria-label="Follow on Email"></a></li></ul></footer><script src=https://blog.mhashim6.me/js/prefixfree.min.9cea59c2cb403a83a6549aadada301521cf8b59b1abc0498e0a10432d186bd67.js></script></body></html>